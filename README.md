# üì¶ Botfarm Users Service

–ù–µ–±–æ–ª—å—à–æ–π REST-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –±–æ—Ç–æ—Ñ–µ—Ä–º—ã.
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ **FastAPI**, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **PostgreSQL**, **SQLAlchemy 2**, **Pydantic v2** –∏ Docker-–æ–∫—Ä—É–∂–µ–Ω–∏–µ.

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:

* —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
* –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞,
* –º–µ—Ö–∞–Ω–∏–∑–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`acquire_lock`) –∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (`release_lock`),
* health-check —Å–µ—Ä–≤–∏—Å–∞.

---

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

* **Python 3.11**
* **FastAPI**
* **PostgreSQL 14**
* **SQLAlchemy 2.0**
* **Pydantic v2**
* **pytest**
* **Docker & Docker Compose**

---

## üìö –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å API

### ‚ñ∂Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**POST** `/api/v1/users/`

–°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ `login` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **400 Bad Request**.

### ‚ñ∂Ô∏è –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**GET** `/api/v1/users/`

### ‚ñ∂Ô∏è –ó–∞—Ö–≤–∞—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**POST** `/api/v1/users/{user_id}/acquire_lock`

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Üí **409 Conflict**

### ‚ñ∂Ô∏è –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

**POST** `/api/v1/users/{user_id}/release_lock`

### ‚ñ∂Ô∏è Healthcheck

**GET** `/health`

---

## üê≥ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
Docker + Docker Compose

–ó–∞–ø—É—Å–∫:

```bash
docker-compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

* API ‚Üí [http://localhost:8000](http://localhost:8000)
* Swagger UI ‚Üí [http://localhost:8000/docs](http://localhost:8000/docs)
* Healthcheck ‚Üí [http://localhost:8000/health](http://localhost:8000/health)

---

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
docker-compose run --rm app pytest
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
3 passed
```

---

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–§–∞–π–ª **`.env.example`**:

```env
DATABASE_URL=postgresql+psycopg2://postgres:postgres@db:5432/botfarm
```

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ Docker Compose –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

---

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
botfarm_service/
‚îÇ
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ test_users.py
‚îÇ
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .env.example
```
